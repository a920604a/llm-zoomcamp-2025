
# ğŸ“ å‘é‡æœå°‹æ•™å­¸ï¼šç”¨ FastEmbed + Qdrant å»ºæ§‹æ™ºèƒ½å•ç­”ç³»çµ±

---

## ğŸ’¡ æ•™å­¸ç›®æ¨™

1. å­¸æœƒå°‡æ–‡å­—è½‰æˆã€Œèªæ„å‘é‡ã€
2. ä½¿ç”¨ Qdrant å»ºç«‹å¯æœå°‹çš„å‘é‡è³‡æ–™åº«
3. å»ºç«‹èªæ„æŸ¥è©¢åŠŸèƒ½ï¼ˆä½¿ç”¨è€…è¼¸å…¥å•é¡Œ â†’ æ‰¾å‡ºæœ€æ¥è¿‘çš„å•ç­”è³‡æ–™ï¼‰

---

## ğŸ§° ç’°å¢ƒéœ€æ±‚

* Python 3.9+

* å¥—ä»¶ï¼š

  ```txt
  fastembed
  qdrant-client
  numpy
  requests
  ```

* æœ¬åœ°å•Ÿå‹• Qdrantï¼ˆç”¨ Docker æœ€æ–¹ä¾¿ï¼‰ï¼š

  ```bash
  docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant
  ```

---

## æ­¥é©Ÿèªªæ˜

---

### âœ… Q1ï¼šå°‡ä¸€æ®µæ–‡å­—è½‰æˆå‘é‡

```python
query = "I just discovered the course. Can I join now?"
embedding = list(embed_model_jina.embed([query]))[0]
print(min(embedding))
```

ğŸ“˜ èªªæ˜ï¼š

* æˆ‘å€‘ç”¨ `FastEmbed` çš„æ¨¡å‹ï¼ŒæŠŠäººé¡çš„å¥å­è½‰æˆå‘é‡ï¼ˆæ•¸å­—é™£åˆ—ï¼‰ã€‚
* é€™å€‹å‘é‡ä»£è¡¨èªæ„æ„ç¾©ï¼Œçµ¦æ©Ÿå™¨æ¯”å°ç”¨ã€‚
* `min(embedding)` åªæ˜¯å–å‡ºæœ€å°å€¼ç•¶ä½œç¤ºç¯„ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹ `len(embedding)` æª¢æŸ¥ç¶­åº¦ï¼ˆ512 ç¶­ï¼‰ã€‚

---

### âœ… Q2ï¼šæ¯”å°å…©æ®µæ–‡å­—çš„ç›¸ä¼¼åº¦

```python
similarity = np.dot(q_vector, doc_vector)
```

ğŸ“˜ èªªæ˜ï¼š

* å‘é‡å…§ç©ï¼ˆdot productï¼‰å¯ä»¥å¿«é€Ÿè¨ˆç®—ã€Œå…©æ®µè©±çš„èªæ„æœ‰å¤šåƒã€ã€‚
* å¦‚æœçµæœæ¥è¿‘ `1`ï¼Œä»£è¡¨èªæ„å¹¾ä¹ä¸€æ¨£ã€‚
* è¨˜å¾—é€™è£¡çš„å‘é‡å¿…é ˆæ˜¯å·²ç¶“æ­£è¦åŒ–ï¼ˆFastEmbed è‡ªå‹•è™•ç†ï¼‰ã€‚

---

### âœ… Q3ï¼šä¸Šå‚³ä¸€æ‰¹ FAQ æ–‡ä»¶åˆ° Qdrant

```python
client.create_collection(...)  # å»ºç«‹è³‡æ–™åº«
client.upsert(...)             # ä¸Šå‚³å‘é‡èˆ‡å…§å®¹
client.query_points(...)       # æŸ¥è©¢æœ€ç›¸è¿‘çš„è³‡æ–™
```

ğŸ“˜ èªªæ˜ï¼š

* æ¯ä¸€ç­†æ–‡ä»¶ï¼ˆåŒ…å« text + questionï¼‰éƒ½è½‰æˆå‘é‡å¾Œå„²å­˜é€² Qdrantã€‚
* æŸ¥è©¢æ™‚ Qdrant å¹«ä½ ç®—èªæ„è·é›¢ï¼Œå›å‚³æœ€æ¥è¿‘çš„è³‡æ–™ã€‚

ğŸ’¡ åˆå­¸è€…å°çŸ¥è­˜ï¼š

> ä½ å¯ä»¥æƒ³åƒ Qdrant æ˜¯ä¸€å€‹è¶…å¤§å‹çš„ã€Œèªæ„å­—å…¸ã€ï¼Œå®ƒä¸æ˜¯ç”¨é—œéµå­—æ¯”å°ï¼Œè€Œæ˜¯ç”¨ã€Œæ„æ€ã€æ‰¾ç­”æ¡ˆã€‚

---

### âœ… Q4ï¼šæ”¹è‰¯å‘é‡å“è³ªï¼ŒæŠŠ `question + text` çµåˆå¾Œä¸Šå‚³

```python
full_text = doc['question'] + ' ' + doc['text']
```

ğŸ“˜ èªªæ˜ï¼š

* ä½¿ç”¨è€…è¼¸å…¥çš„å•é¡Œå¯èƒ½ä¸åªå°æ‡‰æ–‡ä»¶çš„ `question`ï¼Œæ‰€ä»¥æŠŠä¸Šä¸‹æ–‡ä¹Ÿä¸€èµ·æ”¾é€²å‘é‡è£¡æœƒæ›´æº–ã€‚
* é€™å°±åƒè®“æ¨¡å‹è®€æ›´å¤šè³‡è¨Šä¾†ã€Œç†è§£é€™ç­†è³‡æ–™ã€ã€‚

---

### âœ… Q5ï¼šé¸æ“‡åµŒå…¥æ¨¡å‹

```python
models_list = TextEmbedding.list_supported_models()
min_model = min(models_list, key=lambda x: x['dim'])
```

ğŸ“˜ èªªæ˜ï¼š

* é€™æ®µæœƒåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ FastEmbed æ¨¡å‹ï¼Œä¸¦é¸å‡ºã€Œæœ€å°ç¶­åº¦ã€çš„æ¨¡å‹ã€‚
* å°æ¨¡å‹å¥½è™•ï¼šé€Ÿåº¦å¿«ã€è¨˜æ†¶é«”çœã€‚
* å¸¸ç”¨æ¨¡å‹èªªæ˜ï¼š

  | æ¨¡å‹åç¨±                                 | ç¶­åº¦  | èªªæ˜           |
  | ------------------------------------ | --- | ------------ |
  | `jinaai/jina-embeddings-v2-small-en` | 512 | ç²¾æº–ä½†ç¨å¤§        |
  | `BAAI/bge-small-en`                  | 384 | å¿«é€Ÿï¼Œé©åˆè³‡æºæœ‰é™çš„å°ˆæ¡ˆ |

---

### âœ… Q6ï¼šä½¿ç”¨çœŸå¯¦èª²ç¨‹ FAQ å»ºç«‹å‘é‡è³‡æ–™åº«

```python
docs_url = 'https://github.com/.../documents.json'
```

ğŸ“˜ èªªæ˜ï¼š

* å°ˆæ¡ˆä¸­å…§å»ºäº†ä¸€æ‰¹ä¾†è‡ª DataTalks.Club çš„èª²ç¨‹ FAQ è³‡æ–™ã€‚
* æˆ‘å€‘ç”¨ `requests.get()` ä¸‹è¼‰å¾Œåªç¯©é¸æŸèª²ç¨‹ï¼Œä¾‹å¦‚ `machine-learning-zoomcamp`ã€‚
* æ¯ä¸€ç­†è³‡æ–™ä¸€æ¨£è½‰æˆå‘é‡ã€åŠ ä¸Š `text/section/course` ç­‰ metadataã€‚

---

## ğŸ§ª æŸ¥è©¢ç¯„ä¾‹èªªæ˜ï¼ˆåŒ Q3/Q4/Q6 é€šç”¨ï¼‰

```python
res = search("I just discovered the course. Can I join now?")
point = res.points[0]
print(f"æœ€ç›¸ä¼¼å•å¥: {point.payload['question']}")
print(f"å…§å®¹æ‘˜è¦: {point.payload['text'][:100]}")
```

---

## ğŸ”§ å°å·¥å…·å»ºè­°ï¼šå°è£æŸ¥è©¢å‡½å¼

```python
def pretty_print(res):
    for point in res.points:
        print("ğŸ§  ç›¸ä¼¼å•é¡Œ:", point.payload.get("question"))
        print("ğŸ“Œ èª²ç¨‹:", point.payload.get("course"))
        print("ğŸ“„ å›ç­”æ‘˜è¦:", point.payload.get("text")[:200])
        print("ğŸ“Š ç›¸ä¼¼åº¦:", f"{point.score:.4f}")
        print("="*50)
```

---

## ğŸ¯ å»¶ä¼¸ä»»å‹™èˆ‡ç·´ç¿’ï¼ˆå¯ä»¥å‡ºä½œæ¥­ï¼‰

1. **ç”¨ä¸­æ–‡è³‡æ–™åšä¸€æ¨£çš„æµç¨‹**ï¼ˆæ”¹ç”¨ bge-m3 å¤šèªæ¨¡å‹ï¼‰
2. **åŠ å…¥ Streamlit å‰ç«¯**ï¼Œè®“ä½¿ç”¨è€…èƒ½è¼¸å…¥æŸ¥è©¢èªå¥
3. **ç”¨ sklearn åšå‘é‡èšé¡åˆ†æ**ï¼ˆKMeans + PCAï¼‰
4. **æ”¯æ´ Top-K ç›¸ä¼¼å•å¥å›å‚³**ï¼ˆ`limit=5`ï¼‰
5. **æ¯”è¼ƒä¸åŒæ¨¡å‹æŸ¥è©¢çµæœå·®ç•°**

---

## ğŸ§± é€²éšèªªæ˜ï¼ˆè¬›çµ¦å·¥ç¨‹å¸«è½ï¼‰

* FastEmbed é€é Rust ç·¨å¯«ã€æ•ˆèƒ½éå¸¸å¥½ï¼Œå…§å»ºå¤šæ¨¡å‹ï¼ˆç„¡éœ€ HuggingFace Tokenï¼‰
* `Qdrant` æ”¯æ´ Remote Embeddingï¼Œåªè¦ä½ æŒ‡å®š model åç¨±ï¼Œå®ƒæœƒè‡ªå‹•åµŒå…¥ï¼ˆä¼ºæœå™¨æœ‰æ”¯æ´æ‰è¡Œï¼‰
* æœ¬åœ°éƒ¨ç½² Qdrant æ™‚å»ºè­°æ­é… persistent volume é¿å…è³‡æ–™ä¸Ÿå¤±
* å¯æ”¹ç”¨ Milvus / Weaviate / Chroma åšé¡ä¼¼åŠŸèƒ½ï¼ˆä½†èªæ³•ä¸åŒï¼‰

